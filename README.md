# OTP Service

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ—Å—Ç–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–º–æ—â—å—é –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö OTP-–∫–æ–¥–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É –∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ Email, SMS (—ç–º—É–ª—è—Ç–æ—Ä), Telegram, –∞ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª.

## ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- üë§ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ–ª–µ–π: `USER`, `ADMIN`
- üîß –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç:
  - –ò–∑–º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é OTP (–¥–ª–∏–Ω–∞ –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
  - –ü–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
  - –£–¥–∞–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º–∏ OTP-–∫–æ–¥—ã
- üì© –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
  - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å OTP-–∫–æ–¥
  - –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ Email / SMS / Telegram / —Ñ–∞–π–ª
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
- ‚è±Ô∏è –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∫–æ–¥—ã –≤ —Å—Ç–∞—Ç—É—Å `EXPIRED`
- üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ AOP
- üåê Swagger UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
features/
  auth/          # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, JWT
  otp/           # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ö—Ä–∞–Ω–µ–Ω–∏–µ OTP-–∫–æ–¥–æ–≤
  otp_config/    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OTP
  user/          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  delivery/      # –ö–∞–Ω–∞–ª—ã –¥–æ—Å—Ç–∞–≤–∫–∏ (email, sms, telegram, file)
common/          # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –∞—Å–ø–µ–∫—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
db.migration/    # Flyway –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

- Java 23
- PostgreSQL 17
- Gradle 8.13
- SMPP —ç–º—É–ª—è—Ç–æ—Ä (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SMS)
- Telegram Bot Token (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram)
- Flyway (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)

### üì¶ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL 17 –∑–∞–ø—É—â–µ–Ω, –≤–ø–∏—à–∏—Ç–µ –µ–≥–æ –ø–∞—Ä–µ–º–µ—Ç—Ä—ã –≤ `application.yml` (–∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ `application-template.yml`).

   üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **Email (SMTP)** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SMTP-—Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TLS. –ü—Ä–∏–º–µ—Ä –¥–ª—è Gmail:
     ```yaml
     spring:
       mail:
         host: smtp.gmail.com
         port: 587
         username: your_email@gmail.com
         password: your_app_password
         properties:
           mail.smtp.auth: true
           mail.smtp.starttls.enable: true
     email:
       from: your_email@gmail.com
     ```
     ‚ùó –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.

   - **Telegram** ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é [@BotFather](https://t.me/BotFather), –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ–ø–∏—à–∏—Ç–µ:
     ```yaml
     telegram:
       token: 123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
     ```

   - **SMPP** ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —ç–º—É–ª—è—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, [SMPPSim](https://github.com/opensmpp/smppsim)) –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
     ```yaml
     smpp:
       host: localhost
       port: 2775
       systemId: smppclient1
       password: password
       systemType: OTP
       sourceAddr: OTPService
     ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `otp_service` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é Flyway (–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ).
4. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   ./gradlew build
   ```
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   ./gradlew bootRun
   ```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ **Swagger UI**:

- **URL**: [http://localhost:8080/swagger-ui/index.html#/](http://localhost:8080/swagger-ui/index.html#/)

–õ–∏–±–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ:

- **–§–∞–π–ª**: [docs/openapi-spec.json](docs/openapi-spec.json)

---

**–ê–≤—Ç–æ—Ä:** @abigotado

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π [MIT](LICENSE).

## üì¨ –ü—Ä–∏–º–µ—Ä—ã API-–∑–∞–ø—Ä–æ—Å–æ–≤

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
POST `/api/auth/register`
```json
{
  "username": "user1",
  "password": "password"
}
```

### –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
POST `/api/auth/login`
```json
{
  "username": "user1",
  "password": "password"
}
```

–û—Ç–≤–µ—Ç:
```json
{
  "token": "..."
}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OTP-–∫–æ–¥–∞

POST `/api/otp/generate`
```json
{
  "operationId": "123e4567-e89b-12d3-a456-426614174000",
  "channel": "EMAIL",
  "recipient": "user@example.com"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ OTP-–∫–æ–¥–∞

POST `/api/otp/validate`
```json
{
  "operationId": "123e4567-e89b-12d3-a456-426614174000",
  "code": "456789"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω)

GET `/api/admin/users`
```
Authorization: Bearer <token>
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω)

DELETE `/api/admin/users/{userId}`
```
Authorization: Bearer <token>
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ OTP (–∞–¥–º–∏–Ω)

PATCH `/api/admin/config`
```
Authorization: Bearer <token>
```

```json
{
  "codeLength": 6,
  "ttlSeconds": 120
}
```
